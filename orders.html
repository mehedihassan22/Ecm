<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShopX — Orders</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
<header class="header">
  <a class="logo" href="index.html">ShopX</a>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="category.html">Categories</a>
    <a class="active" href="orders.html">Orders</a>
  </nav>
  <form id="siteSearchForm" class="site-search">
    <input id="siteSearchInput" type="search" placeholder="Search products…" />
    <select id="siteSearchCat">
      <option value="all">All</option>
    </select>
    <button class="btn" type="submit">Search</button>
  </form>
  <div class="auth-area" id="authArea"></div>
</header>

<main class="container">
  <h1>Your Orders</h1>
  <div id="ordersWrap" class="stack"></div>
</main>

<footer class="footer">© <span id="year"></span> ShopX.</footer>

<script src="assets/data.js"></script>
<script src="assets/auth.js"></script>
<script src="assets/app.js"></script>
<script src="assets/cart.js"></script>
<script>
  renderAuthArea();
  wireGlobalSearch();
  document.getElementById('year').textContent = new Date().getFullYear();

  if (!currentUser()) {
    sessionStorage.setItem('redirectTo', 'orders.html');
    alert('Please log in to view your orders.');
    location.href = 'login.html';
  }

  // fill header category list
  const catSel = document.getElementById('siteSearchCat');
  window.DB.categories.forEach(c => catSel.insertAdjacentHTML('beforeend', `<option value="${c.slug}">${c.name}</option>`));

  // Load orders from localStorage (demo)
  const LS_ORDERS = 'shopx_orders';
  let orders = [];
  try { orders = JSON.parse(localStorage.getItem(LS_ORDERS)) || []; } catch {}
  const wrap = document.getElementById('ordersWrap');

  if (!orders.length) {
    wrap.innerHTML = `<p class="muted">You don't have any orders yet.</p>`;
  } else {
    wrap.innerHTML = orders.slice().reverse().map(o => `
      <section class="card section">
        <div class="section-title">
          <h3>Order <span class="badge">${o.id}</span></h3>
          <span class="muted">${new Date(o.when).toLocaleString()}</span>
        </div>
        <table class="table" style="margin-top:10px">
          <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr></thead>
          <tbody>
            ${o.items.map(i=>`
              <tr>
                <td>${i.title}</td>
                <td>${i.qty}</td>
                <td>${formatPrice(i.price)}</td>
                <td>${formatPrice(i.price * i.qty)}</td>
              </tr>
            `).join('')}
          </tbody>
          <tfoot>
            <tr><td colspan="3">Subtotal</td><td>${formatPrice(o.amounts.subtotal)}</td></tr>
            <tr><td colspan="3">Shipping</td><td>${formatPrice(o.amounts.shipping)}</td></tr>
            <tr><td colspan="3"><strong>Grand Total</strong></td><td><strong>${formatPrice(o.amounts.grand)}</strong></td></tr>
          </tfoot>
        </table>
        <p class="muted">Payment: ${o.payment.method.toUpperCase()} — ${o.payment.status}</p>
        <p class="muted">Ship to: ${o.shipping.name}, ${o.shipping.address}, ${o.shipping.city} ${o.shipping.zip}</p>
      </section>
    `).join('');
  }
</script>
</body>
</html>
