<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShopX — Categories</title>
  <link rel="stylesheet" href="assets/styles.css" />
</head>
<body>
  <header class="header">
  <a class="logo" href="index.html">ShopX</a>
  <nav class="nav">
    <a href="index.html">Home</a>
    <a href="category.html">Categories</a>
    <a href="orders.html" id="ordersLink" style="display:none">Orders</a>
  </nav>
  <form id="siteSearchForm" class="site-search">
    <input id="siteSearchInput" type="search" placeholder="Search products…" />
    <select id="siteSearchCat">
      <option value="all">All</option>
    </select>
    <button class="btn" type="submit">Search</button>
  </form>
  <div class="auth-area" id="authArea"></div>
</header>


  <main class="container">
    <div class="section-title">
      <h1>Browse Products</h1>
    </div>

    <div class="toolbar">
      <div class="toolbar-row">
        <label class="field">
          <span>Search</span>
          <input id="searchInput" type="search" placeholder="Search products…" />
        </label>

        <label class="field">
          <span>Category</span>
          <select id="categorySelect"></select>
        </label>

        <label class="field">
          <span>Sort</span>
          <select id="sortSelect">
            <option value="popularity">Popularity</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
            <option value="newest">Newest</option>
          </select>
        </label>
      </div>
    </div>

    <div id="productGrid" class="grid"></div>
  </main>

  <footer class="footer">© <span id="year"></span> ShopX.</footer>

  <script src="assets/data.js"></script>
  <script src="assets/auth.js"></script>
  <script src="assets/app.js"></script>
  <script>
    renderAuthArea();
    wireGlobalSearch();
    document.getElementById('year').textContent = new Date().getFullYear();

  // Setup category dropdowns (header already filled, but ok if duplicated)
    const { categories, products } = window.DB;
    const catSel = document.getElementById('categorySelect');
    catSel.innerHTML = `<option value="all">All</option>` + categories.map(c => `<option value="${c.slug}">${c.name}</option>`).join('');

    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');

  // Seed from URL params (site-wide search)
    const urlQ = getParam('q') || '';
    const urlCat = getParam('cat') || 'all';
    searchInput.value = urlQ;
    catSel.value = urlCat;

    const state = { q: urlQ, cat: urlCat, sort: 'popularity' };

    function apply() {
      let list = [...products];
      if (state.cat !== 'all') list = list.filter(p => p.category === state.cat);
      if (state.q) {
        const q = state.q.toLowerCase();
        list = list.filter(p =>
          p.title.toLowerCase().includes(q) ||
          p.description.toLowerCase().includes(q)
       );
      }
      if (state.sort === 'price-asc') list.sort((a,b)=>a.price-b.price);
      else if (state.sort === 'price-desc') list.sort((a,b)=>b.price-a.price);
      else if (state.sort === 'newest') list.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
      else list.sort((a,b)=>b.popularity-a.popularity);

    mountProducts('productGrid', list);
  }

  searchInput.addEventListener('input', (e)=>{ state.q = e.target.value.trim(); apply(); });
  catSel.addEventListener('change', (e)=>{ state.cat = e.target.value; apply(); });
  sortSelect.addEventListener('change', (e)=>{ state.sort = e.target.value; apply(); });

  apply();
</script>

</body>
</html>
